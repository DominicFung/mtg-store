{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Dom/Projects/mtg-store/web/app/box/imageCropper.tsx"],"sourcesContent":["import { Rnd } from \"react-rnd\";\nimport { useEffect, useRef, useState } from \"react\";\nimport JSZip from \"jszip\";\n\ninterface Props {\n  imageSrc: string,\n  setCrops: (a: [string, string, string]) => void\n}\n\nconst BOX_WIDTHS = [293, 255, 293];\nconst ORIGINAL_HEIGHT = 326;\nconst TOTAL_ORIGINAL_WIDTH = BOX_WIDTHS.reduce((a, b) => a + b, 0);\nconst GAP = 10;\n\nexport default function GroupedCropBoxes({ imageSrc, setCrops }: Props) {\n  const [imgDimensions, setImgDimensions] = useState({ width: 0, height: 0 });\n  const [groupBox, setGroupBox] = useState({ x: 0, y: 0, width: 0, height: 0 });\n  const [croppedImages, setCroppedImages] = useState<string[]>([]);\n\n  const calculateFittingSize = (imgW: number, imgH: number) => {\n    const scaleX = imgW / TOTAL_ORIGINAL_WIDTH;\n    const scaleY = imgH / ORIGINAL_HEIGHT;\n    const scale = Math.min(scaleX, scaleY);\n\n    const width = TOTAL_ORIGINAL_WIDTH * scale;\n    const height = ORIGINAL_HEIGHT * scale;\n    const x = (imgW - width) / 2;\n    const y = (imgH - height) / 2;\n\n    return { x, y, width, height };\n  };\n\n  useEffect(() => {\n    if (imgDimensions.width && imgDimensions.height) {\n      const initialBox = calculateFittingSize(\n        imgDimensions.width,\n        imgDimensions.height\n      );\n      setGroupBox(initialBox);\n    }\n  }, [imgDimensions]);\n\n  const handleCropAndDownload = async () => {\n    const img = new Image();\n    img.src = imageSrc;\n    await img.decode();\n\n    const scaleX = img.naturalWidth / imgDimensions.width;\n    const scaleY = img.naturalHeight / imgDimensions.height;\n\n    let xOffset = 0;\n    const previews: string[] = [];\n    const zip = new JSZip();\n    let crops: [string, string, string] = [\"\", \"\", \"\"]\n\n    for (let i = 0; i < 3; i++) {\n      const widthRatio = BOX_WIDTHS[i] / TOTAL_ORIGINAL_WIDTH;\n      const boxWidth = groupBox.width * widthRatio;\n\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = boxWidth * scaleX;\n      canvas.height = groupBox.height * scaleY;\n\n      const ctx = canvas.getContext(\"2d\")!;\n      ctx.drawImage(\n        img,\n        (groupBox.x + xOffset) * scaleX,\n        groupBox.y * scaleY,\n        boxWidth * scaleX,\n        groupBox.height * scaleY,\n        0,\n        0,\n        canvas.width,\n        canvas.height\n      );\n\n      const dataUrl = canvas.toDataURL(\"image/png\");\n      previews.push(dataUrl);\n\n      // Add to ZIP\n      const base64Data = dataUrl.replace(/^data:image\\/png;base64,/, \"\");\n      zip.file(`crop-${i + 1}.png`, base64Data, { base64: true });\n\n      // add to cropped images\n      crops[i] = dataUrl\n\n      xOffset += boxWidth;\n    }\n\n    setCroppedImages(previews);\n    setCrops(crops)\n\n    //Generate and download ZIP\n    const content = await zip.generateAsync({ type: \"blob\" });\n    const zipUrl = URL.createObjectURL(content);\n    const link = document.createElement(\"a\");\n    link.href = zipUrl;\n    link.download = \"cropped-images.zip\";\n    link.click();\n  };\n\n  return (\n    <div className=\"relative mt-4\">\n      <img\n        src={imageSrc}\n        alt=\"Uploaded\"\n        onLoad={(e) => {\n          const { width, height } = e.currentTarget;\n          setImgDimensions({ width, height });\n        }}\n        style={{ width: \"100%\", maxWidth: \"800px\" }}\n      />\n\n      <div\n        className=\"absolute top-0 left-0\"\n        style={{\n          width: imgDimensions.width,\n          height: imgDimensions.height,\n        }}\n      >\n        {groupBox.width > 0 && (\n          <Rnd\n            size={{ width: groupBox.width, height: groupBox.height }}\n            position={{ x: groupBox.x, y: groupBox.y }}\n            onDragStop={(_, d) => {\n              const maxX = imgDimensions.width - groupBox.width;\n              const maxY = imgDimensions.height - groupBox.height;\n              setGroupBox({\n                ...groupBox,\n                x: Math.max(0, Math.min(d.x, maxX)),\n                y: Math.max(0, Math.min(d.y, maxY)),\n              });\n            }}\n            onResizeStop={(_, __, ref, ___, pos) => {\n              let newWidth = parseFloat(ref.style.width);\n              let newHeight = parseFloat(ref.style.height);\n\n              const scaleX = imgDimensions.width / TOTAL_ORIGINAL_WIDTH;\n              const scaleY = imgDimensions.height / ORIGINAL_HEIGHT;\n              const maxScale = Math.min(scaleX, scaleY);\n\n              const maxW = TOTAL_ORIGINAL_WIDTH * maxScale;\n              const maxH = ORIGINAL_HEIGHT * maxScale;\n\n              newWidth = Math.min(newWidth, maxW);\n              newHeight = Math.min(newHeight, maxH);\n\n              setGroupBox({\n                width: newWidth,\n                height: newHeight,\n                x: Math.max(0, Math.min(pos.x, imgDimensions.width - newWidth)),\n                y: Math.max(0, Math.min(pos.y, imgDimensions.height - newHeight)),\n              });\n            }}\n            lockAspectRatio={TOTAL_ORIGINAL_WIDTH / ORIGINAL_HEIGHT}\n            bounds=\"parent\"\n            style={{\n              border: \"1px dashed #333\",\n              display: \"flex\",\n              flexDirection: \"row\",\n              position: \"absolute\",\n              background: \"rgba(255,255,255,0.02)\",\n            }}\n          >\n            {BOX_WIDTHS.map((w, i) => {\n              const widthRatio = w / TOTAL_ORIGINAL_WIDTH;\n              return (\n                <div\n                  key={i}\n                  style={{\n                    width: `${widthRatio * 100}%`,\n                    height: \"100%\",\n                    border: \"2px solid red\",\n                    boxSizing: \"border-box\",\n                  }}\n                />\n              );\n            })}\n          </Rnd>\n        )}\n      </div>\n\n      <button\n        className=\"mt-4 px-4 py-2 bg-green-600 text-white rounded\"\n        onClick={handleCropAndDownload}\n      >\n        Crop and Download\n      </button>\n\n      {/* Preview */}\n      {croppedImages.length > 0 && (\n        <div className=\"mt-4 flex gap-[10px]\">\n          {croppedImages.map((src, i) => (\n            <img\n              key={i}\n              src={src}\n              alt={`Crop ${i + 1}`}\n              className=\"border border-gray-300 rounded shadow\"\n              style={{ maxHeight: \"200px\" }}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 258, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Dom/Projects/mtg-store/web/app/box/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useCallback } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport ImageCropper from './imageCropper';\nimport SpinningBoxWithTextures from './spinningBox';\n\nexport default function Home() {\n  const [image, setImage] = useState<string | null>(null);\n  const [crops, setCrops] = useState<[string, string, string] | null>(null);\n\n  const onDrop = useCallback((acceptedFiles: File[]) => {\n    const file = acceptedFiles[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = () => setImage(reader.result as string);\n    reader.readAsDataURL(file);\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: { 'image/*': [] },\n    multiple: false,\n  });\n\n  return (\n    <div className=\"p-4\">\n      {/* {crops && <div className=''>\n        <SpinningBoxWithTextures\n          textures={crops} // base64 or hosted image URLs\n          glbPath=\"/models/three-sided-box.glb\"\n        />\n      </div>} */}\n      \n      <div\n        {...getRootProps()}\n        className={`border-2 border-dashed p-10 text-center rounded-md cursor-pointer transition ${\n          isDragActive ? 'border-blue-500 bg-blue-50' : 'border-gray-300'\n        }`}\n      >\n        <input {...getInputProps()} />\n        {isDragActive ? (\n          <p className=\"text-blue-500 font-semibold\">Drop the image here...</p>\n        ) : (\n          <p className=\"text-gray-500\">Drag & drop an image here, or click to select one</p>\n        )}\n      </div>\n\n      {image && <ImageCropper imageSrc={image} setCrops={setCrops}/>}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAAA;AACA;;;AAJA;;;;AAOe,SAAS;;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAmC;IAEpE,MAAM,SAAS,CAAA,GAAA,6JAAA,CAAA,cAAW,AAAD;oCAAE,CAAC;YAC1B,MAAM,OAAO,aAAa,CAAC,EAAE;YAC7B,IAAI,CAAC,MAAM;YAEX,MAAM,SAAS,IAAI;YACnB,OAAO,MAAM;4CAAG,IAAM,SAAS,OAAO,MAAM;;YAC5C,OAAO,aAAa,CAAC;QACvB;mCAAG,EAAE;IAEL,MAAM,EAAE,YAAY,EAAE,aAAa,EAAE,YAAY,EAAE,GAAG,CAAA,GAAA,2KAAA,CAAA,cAAW,AAAD,EAAE;QAChE;QACA,QAAQ;YAAE,WAAW,EAAE;QAAC;QACxB,UAAU;IACZ;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAQb,6LAAC;gBACE,GAAG,cAAc;gBAClB,WAAW,CAAC,6EAA6E,EACvF,eAAe,+BAA+B,mBAC9C;;kCAEF,6LAAC;wBAAO,GAAG,eAAe;;;;;;oBACzB,6BACC,6LAAC;wBAAE,WAAU;kCAA8B;;;;;6CAE3C,6LAAC;wBAAE,WAAU;kCAAgB;;;;;;;;;;;;YAIhC,uBAAS,6LAAC,8HAAA,CAAA,UAAY;gBAAC,UAAU;gBAAO,UAAU;;;;;;;;;;;;AAGzD;GA7CwB;;QAagC,2KAAA,CAAA,cAAW;;;KAb3C","debugId":null}}]
}